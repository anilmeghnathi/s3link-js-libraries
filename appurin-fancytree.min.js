Appurin.namespace("Appurin.tree"),Appurin.tree.createFancyTree=function(T,f){var e="#"+f.renderTo,N={extensions:["persist"],title:"Appurin Tree",rootCollapsible:!1,keyboard:!0,cookie:{expires:null},keyPathSeparator:"/",imagePath:"jquery/images/",checkbox:!1,selectMode:f.selectMode,source:[{title:"Test Node 1",lazy:!1},{title:"Test Node 2",select:!0}],persist:{expandLazy:!0,store:"auto"},activate:function(e,t){onClickTreeNode(t.node,e),Appurin.tree.treeSelectionUpdate(t.node)},select:function(e,t){t.node.setActive(!0),Appurin.tree.treeSelectionUpdate(t.node)},expand:function(e,t){j$(".fancytree-title").easyTooltip({width:"200px",isLightning:!0})},click:function(e,t){},lazyLoad:function(e,t){onExpandTreeNode(t.node,e);var a=new j$.Deferred;t.result=a;var r=t.node,d=T+"/"+r.data.userData.key,o=r.data.userData.objectType,n=r.data.userData.nodeType,i=r.data.userData.childObjectType,l=r.data.userData.captionField,s=r.data.userData.titleField,c=r.data.userData.nodeQuery,p=r.data.userData.showGroupByCharts,u=r.data.userData.showResultObjectsInTree,h=r.data.userData.showNewButton,y=r.data.userData.tncId,e="";r.data.userData.orderChildrenBy+""!="undefined"&&(e=r.data.userData.orderChildrenBy);t="{}";r.data.userData.queryParameters+""!="undefined"&&(t=r.data.userData.queryParameters);r={};r.objType=o,r.id=d,r.dataFields="Id,Name",r.nodeType=n,r.nodeQuery=c,r.childObjectType=i,r.captionField=l,r.titleField=s,r.showGroupByCharts=p,r.showResultObjectsInTree=u,r.showNewButton=h,r.tncId=y,r.orderChildrenBy=e,r.queryParameters=t,r.dataFieldsByObjectType=f.displayColumnNames,r.showMissingAWSFiles=f.isShowMisssingAWSFilesOnly,r.showItemsCount=f.isShowItemsCount,apTreeRemotingModel.getChildren(JSON.stringify(r),function(e,t){Appurin.tree.setCheckableForChildren(e,N),a.resolve(e)}),j$(".fancytree-title").easyTooltip({width:"200px",isLightning:!0})}};return j$.extend(N,f),N.checkbox&&Appurin.tree.setCheckableForChildren(N.source,N),j$(e).fancytree(N)},Appurin.tree.treeSelectionUpdate=function(e){var t=e.tree.getSelectedNodes(),r=[],d=[];j$.each(t,function(e,t){var a;-1!=d.indexOf(t.data.userData.key)||t.hideCheckbox||(a=t.getParent(),"NodeType_GroupBy"!=t.data.userData.nodeType&&"NodeType_GroupByRoot"!=t.data.userData.nodeType&&(a.hideCheckbox&&a.selected||"NodeType_GroupBy"==a.data.userData.nodeType&&a.selected||!a.selected)&&(newNodeTodAdd={},newNodeTodAdd.fullPath=t.getKeyPath(),newNodeTodAdd.id=t.data.userData.key,newNodeTodAdd.objectType=t.data.userData.childObjectType,"AmazonFile"==t.data.userData.objectType||"AmazonFolder"==t.data.userData.objectType?"AmazonFile"!=t.data.userData.objectType&&"AmazonFolder"!=t.data.userData.objectType||(newNodeTodAdd.detailUrl=""):newNodeTodAdd.detailUrl="Group"==t.data.userData.childObjectType?"/setup/own/groupdetail.jsp?id="+t.key:"/"+t.data.userData.key,newNodeTodAdd.icon=t.tree.options.imagePath+t.data.icon,newNodeTodAdd.name=Appurin.tree.getHierarchicalTreeNodePath(t,t.tree.data.NumberOfNodePathLevels),r.push(newNodeTodAdd),d.push(t.data.userData.key)))}),Appurin.tree.getSelectedNodesInformation(e.tree.options.renderTo,r)},Appurin.tree.getHierarchicalTreeNodePath=function(e,t){var a=e.title,r=parseInt(t);for(e=e.getParent();null!=e&&!e.isRoot()&&0<r;){a=e.title+"/"+a;e=e.getParent(),r--}return a},Appurin.tree.getSelectedNodesInformation=function(e,t){var a=j$("div[id$='"+e+"']").parent().parent().find("tbody[id$='treeSelectedRecordsTableBody']");if(null==a.html())return!1;j$("div[id$='"+e+"']").parent().parent().parent().find("input[id$='hiddenFieldForSelectedTreeNodesJsonString']").val(JSON.stringify(t)),null!=a.find("#treeNoRecordSelectedRow").html()&&(treeNoRecordSelectedRow=a.find("#treeNoRecordSelectedRow").css("display","table-row")),a.html(""),0==t.length?a.append(treeNoRecordSelectedRow):j$.each(t,function(e,t){t=Appurin.tree.getNodeTitleHTML(t);a.append("<tr><td class=''>"+t+"</td></tr>")})},Appurin.tree.getNodeTitleHTML=function(e){var t="";return""!=e.icon&&""!=e.detailUrl?t=t+"<img src='"+e.icon+"' alt='' class='slds-icon slds-icon--x-small'/> <a href="+e.detailUrl+" class='slds-p-left--xx-small' target='_blank'>"+e.name+"</a>":""==e.icon&&""!=e.detailUrl?t=t+"<a href="+e.detailUrl+" class='slds-p-left--xx-small' target='_blank'>"+e.name+"</a>":""!=e.icon&&""==e.detailUrl&&(t=t+"<img src='"+e.icon+"' alt='' class='slds-icon slds-icon--x-small' /><span style='padding-left:10px;'>"+e.name+"</span>"),t},Appurin.tree.setCheckableForChildren=function(e,o){checkableNodes=o.checkableNodes,j$.each(e,function(e,t){var a=t.userData.objectType,r=t.userData.childObjectType,d=t.userData.recordType;t.userData.checkable&&Appurin.isDefined(a)&&(-1!=j$.inArray(a,checkableNodes)||-1!=j$.inArray(a+"."+d,checkableNodes)||-1!=j$.inArray(r,checkableNodes)||-1!=j$.inArray(r+"."+d,checkableNodes))?t.hideCheckbox=!1:1!=t.hideCheckbox&&(t.hideCheckbox=!0),null!=t.children&&Appurin.tree.setCheckableForChildren(t.children,o)})},Appurin.tree.activateTreeNode=function(e,t){e=j$("#"+e).fancytree("getTree");""!=t&&e.loadKeyPath(t,function(e,t){"loaded"==t||"ok"==t&&(e.setExpanded(!0),e.setActive(!0),j$(e.span).click())})},Appurin.tree.setEasyTooltipForChildren=function(e,t){null!=e&&j$.each(e,function(e,t){t.tooltip=htmlDecode(t.tooltip),Appurin.tree.setEasyTooltipForChildren(t.children,t)})};